#include "stdafx.h"
#include "Fish.h"
#include "Player.h"

Fish::Fish() {
	//モデルを読み込む
	m_fimodelRender.Init("Assets/modelData/fish/fish01.tkm");
	//プレイヤーの位置を取得
	player = FindGO<Player>("player");
}

Fish::~Fish() {

}

void Fish::Update() {
	Move();
	Rotation();
	State();

	m_fimodelRender.Update();

	//座標を教える
	m_fimodelRender.SetPosition(m_fiposition);

	//プレイヤーから魚に向かうベクトルを求める
	Vector3 diff = player->m_position - m_fiposition;
	//ベクトルの長さが40.0fより小さかったら
	if (diff.Length() <= 70.0f) {
		//自身を消去する
		DeleteGO(this);
	}


}

void Fish::Move() {
	if (Fi_Count == 0) {
		m_fiposition.x -= 5.0f;
		m_fiposition.y += 1.5f;
	}
	else if (Fi_Count == 1) {
		m_fiposition.x -= 5.0f;
		m_fiposition.y -= 1.5f;
	}
	else if (Fi_Count == 2) {
		m_fiposition.x += 200.0f;
		m_fiposition.y += 0.5f;
	}
}

void Fish::Rotation() {
	if (Fi_Count == 0) {
		rot.AddRotationDegY(45.0f);
	}
	else if (Fi_Count == 1) {
		rot.AddRotationDegY(-45.0f);
	}
	else if (Fi_Count == 2) {
		
	}
}

void Fish::State() {
	if (m_fiposition.x > 0.0f&&m_fiposition.y>=-9.0f) {
		Fi_Count = 0;
	}
	else if (m_fiposition.x <= 0.0f && m_fiposition.y > -6.0f) {
		Fi_Count = 1;
	}
	else if (m_fiposition.y <= -10.0f) {
		Fi_Count = 2;
	}
}

void Fish::Render(RenderContext& rc) {
	//魚オブジェクトを描画
	m_fimodelRender.Draw(rc);
}